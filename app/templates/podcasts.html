{% extends "base.html" %}

{% block title %}Podcast Feed â€” DraftGuru{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/podcasts.css') }}">
{% endblock %}

{% set tags = [
  "Interview", "Draft Analysis", "Mock Draft", "Prospect Debate",
  "Trade & Intel", "Game Breakdown", "Mailbag", "Event Preview"
] %}

{% block content %}
<main class="container mt-28">

  <!-- ==========================================================================
       PAGE HEADER WITH STATS
       ========================================================================== -->
  <section class="section" style="margin-bottom: 1.5rem;">
    <div class="podcast-page-header">
      <div>
        <h2 class="section-header mono-font uppercase" style="border-left-color: var(--color-accent-fuchsia); margin-bottom: 0.25rem;">
          <svg class="icon icon-lg" style="color: var(--color-accent-fuchsia); margin-right: 0.5rem; display: inline-block;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
            <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
          </svg>
          Podcast Feed
        </h2>
        <p class="section-subtitle" style="margin-bottom: 0;">NBA Draft podcasts from the best voices in scouting</p>
      </div>
      <div class="podcast-page-stats">
        <div class="podcast-stat">
          <div class="podcast-stat__value">{{ total }}</div>
          <div class="podcast-stat__label">Episodes</div>
        </div>
        <div class="podcast-stat">
          <div class="podcast-stat__value">{{ shows | length }}</div>
          <div class="podcast-stat__label">Shows</div>
        </div>
        <div class="podcast-stat">
          <div class="podcast-stat__value">{{ trending_players | length }}</div>
          <div class="podcast-stat__label">Players Tagged</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ==========================================================================
       FEATURED HERO (rendered by JS, only on first page with no tag filter)
       ========================================================================== -->
  {% if not active_tag and offset == 0 %}
  <div id="podcastHero"></div>
  {% endif %}

  <!-- ==========================================================================
       FILTER CHIPS (server-side navigation)
       ========================================================================== -->
  <div class="podcast-controls">
    <div class="podcast-filters">
      <a href="/podcasts" class="filter-chip {{ 'active' if not active_tag else '' }}">All Episodes</a>
      {% for t in tags %}
      <a href="/podcasts?tag={{ t | urlencode }}" class="filter-chip {{ 'active' if active_tag == t else '' }}">{{ t }}</a>
      {% endfor %}
    </div>
  </div>

  <!-- ==========================================================================
       MAIN LAYOUT: EPISODE LIST + SIDEBAR
       ========================================================================== -->
  <div class="podcast-page-layout">
    <!-- Episode List -->
    <div>
      <div class="podcast-page-list" id="pageList">
        <!-- populated by JS -->
      </div>

      <!-- Pagination -->
      {% set total_pages = ((total - 1) // limit + 1) if total > 0 else 1 %}
      {% set current_page = (offset // limit) + 1 %}
      {% if total > limit %}
      <nav class="podcast-pagination" aria-label="Podcast episodes pagination">
        {% set tag_param = "&tag=" ~ (active_tag | urlencode) if active_tag else "" %}
        <a href="/podcasts?offset={{ (current_page - 2) * limit }}{{ tag_param }}"
           class="pagination__button pagination__button--nav {{ 'disabled' if current_page == 1 else '' }}"
           {% if current_page == 1 %}aria-disabled="true" tabindex="-1"{% endif %}>
          <svg class="icon" viewBox="0 0 24 24" style="width: 1rem; height: 1rem;">
            <polyline points="15 18 9 12 15 6" stroke="currentColor" stroke-width="2" fill="none"></polyline>
          </svg>
          Prev
        </a>
        <div class="pagination__numbers">
          {% for p in range(1, total_pages + 1) %}
          {% if p <= 3 or p > total_pages - 2 or (p >= current_page - 1 and p <= current_page + 1) %}
          <a href="/podcasts?offset={{ (p - 1) * limit }}{{ tag_param }}"
             class="pagination__button {{ 'active' if p == current_page else '' }}">{{ p }}</a>
          {% elif p == 4 and current_page > 5 %}
          <span class="pagination__ellipsis">...</span>
          {% elif p == total_pages - 2 and current_page < total_pages - 4 %}
          <span class="pagination__ellipsis">...</span>
          {% endif %}
          {% endfor %}
        </div>
        <a href="/podcasts?offset={{ current_page * limit }}{{ tag_param }}"
           class="pagination__button pagination__button--nav {{ 'disabled' if current_page == total_pages else '' }}"
           {% if current_page == total_pages %}aria-disabled="true" tabindex="-1"{% endif %}>
          Next
          <svg class="icon" viewBox="0 0 24 24" style="width: 1rem; height: 1rem;">
            <polyline points="9 18 15 12 9 6" stroke="currentColor" stroke-width="2" fill="none"></polyline>
          </svg>
        </a>
        <span class="pagination__info">{{ offset + 1 }}-{{ [offset + limit, total] | min }} of {{ total }}</span>
      </nav>
      {% endif %}
    </div>

    <!-- Sidebar -->
    <aside class="podcast-sidebar">
      <!-- Show Directory -->
      <div class="sidebar-card">
        <div class="sidebar-card__header">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:0.875rem;height:0.875rem;">
            <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
            <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
          </svg>
          Shows
        </div>
        <div class="sidebar-card__body" id="showDirectory">
          <!-- populated by JS -->
        </div>
      </div>

      <!-- Trending Player Mentions -->
      <div class="sidebar-card">
        <div class="sidebar-card__header">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:0.875rem;height:0.875rem;">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
          </svg>
          Trending in Podcasts
        </div>
        <div class="sidebar-card__body" id="trendingMentions">
          <!-- populated by JS -->
        </div>
      </div>
    </aside>
  </div>

</main>
{% endblock %}

{% block extra_js %}
<script>
  window.PODCAST_EPISODES = {{ episodes | tojson | safe }};
  window.PODCAST_SHOWS = {{ shows | tojson | safe }};
  window.PODCAST_TRENDING = {{ trending_players | tojson | safe }};
</script>
<script src="{{ url_for('static', path='js/podcasts.js') }}"></script>
{% endblock %}
