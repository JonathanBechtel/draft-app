{% extends "admin/base.html" %}

{% set page_title = "Edit Player" %}
{% set active_nav = "players" %}

{% block admin_content %}
<header class="admin-main__header">
  <h1 class="admin-main__title">Edit Player</h1>
  <p class="admin-main__subtitle">{{ player.display_name }}</p>
</header>

<div class="admin-player-detail-layout">
  <!-- Left Column: Form -->
  <div class="admin-card">
    <form class="admin-form" method="post" action="/admin/players/{{ player.id }}">
      <!-- Basic Info Section -->
      <div class="admin-form__section">
        <h3 class="admin-form__section-title">Basic Info</h3>

        <div class="admin-form__field">
          <label class="admin-form__label" for="display_name">Display Name *</label>
          <input
            class="admin-form__input"
            id="display_name"
            name="display_name"
            type="text"
            value="{{ player.display_name or '' }}"
            required
          />
          <span class="admin-form__help">Full display name (e.g., "LeBron James")</span>
        </div>

        <div class="admin-form__row">
          <div class="admin-form__field">
            <label class="admin-form__label" for="prefix">Prefix</label>
            <input
              class="admin-form__input"
              id="prefix"
              name="prefix"
              type="text"
              value="{{ player.prefix or '' }}"
              placeholder="Jr., Sr., etc."
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="first_name">First Name *</label>
            <input
              class="admin-form__input"
              id="first_name"
              name="first_name"
              type="text"
              value="{{ player.first_name or '' }}"
              required
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="middle_name">Middle Name</label>
            <input
              class="admin-form__input"
              id="middle_name"
              name="middle_name"
              type="text"
              value="{{ player.middle_name or '' }}"
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="last_name">Last Name *</label>
            <input
              class="admin-form__input"
              id="last_name"
              name="last_name"
              type="text"
              value="{{ player.last_name or '' }}"
              required
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="suffix">Suffix</label>
            <input
              class="admin-form__input"
              id="suffix"
              name="suffix"
              type="text"
              value="{{ player.suffix or '' }}"
              placeholder="Jr., III, etc."
            />
          </div>
        </div>

        <!-- Read-only slug display -->
        <div class="admin-form__static-field">
          <span class="admin-form__label">Slug</span>
          <span class="admin-form__static-value">{{ player.slug or '—' }}</span>
        </div>
      </div>

      <!-- Biographical Section -->
      <div class="admin-form__section">
        <h3 class="admin-form__section-title">Biographical</h3>

        <div class="admin-form__row">
          <div class="admin-form__field">
            <label class="admin-form__label" for="birthdate">Birth Date</label>
            <input
              class="admin-form__input"
              id="birthdate"
              name="birthdate"
              type="date"
              value="{{ player.birthdate.isoformat() if player.birthdate else '' }}"
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="shoots">Shoots</label>
            <select class="admin-form__select" id="shoots" name="shoots">
              <option value="">—</option>
              <option value="L" {% if player.shoots == 'L' %}selected{% endif %}>Left</option>
              <option value="R" {% if player.shoots == 'R' %}selected{% endif %}>Right</option>
            </select>
          </div>
        </div>

        <div class="admin-form__row">
          <div class="admin-form__field">
            <label class="admin-form__label" for="birth_city">Birth City</label>
            <input
              class="admin-form__input"
              id="birth_city"
              name="birth_city"
              type="text"
              value="{{ player.birth_city or '' }}"
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="birth_state_province">State/Province</label>
            <input
              class="admin-form__input"
              id="birth_state_province"
              name="birth_state_province"
              type="text"
              value="{{ player.birth_state_province or '' }}"
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="birth_country">Country</label>
            <input
              class="admin-form__input"
              id="birth_country"
              name="birth_country"
              type="text"
              value="{{ player.birth_country or '' }}"
            />
          </div>
        </div>

        <div class="admin-form__row">
          <div class="admin-form__field">
            <label class="admin-form__label" for="school">College/School</label>
            <input
              class="admin-form__input"
              id="school"
              name="school"
              type="text"
              value="{{ player.school or '' }}"
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="high_school">High School</label>
            <input
              class="admin-form__input"
              id="high_school"
              name="high_school"
              type="text"
              value="{{ player.high_school or '' }}"
            />
          </div>
        </div>
      </div>

      <!-- Draft Info Section -->
      <div class="admin-form__section">
        <h3 class="admin-form__section-title">Draft Info</h3>

        <div class="admin-form__row">
          <div class="admin-form__field">
            <label class="admin-form__label" for="draft_year">Draft Year</label>
            <input
              class="admin-form__input"
              id="draft_year"
              name="draft_year"
              type="number"
              min="1947"
              max="2030"
              value="{{ player.draft_year or '' }}"
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="draft_round">Round</label>
            <input
              class="admin-form__input"
              id="draft_round"
              name="draft_round"
              type="number"
              min="1"
              max="10"
              value="{{ player.draft_round or '' }}"
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="draft_pick">Pick</label>
            <input
              class="admin-form__input"
              id="draft_pick"
              name="draft_pick"
              type="number"
              min="1"
              max="60"
              value="{{ player.draft_pick or '' }}"
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="draft_team">Draft Team</label>
            <input
              class="admin-form__input"
              id="draft_team"
              name="draft_team"
              type="text"
              placeholder="Team abbreviation"
              value="{{ player.draft_team or '' }}"
            />
          </div>
        </div>
      </div>

      <!-- NBA Career Section -->
      <div class="admin-form__section">
        <h3 class="admin-form__section-title">NBA Career</h3>

        <div class="admin-form__row">
          <div class="admin-form__field">
            <label class="admin-form__label" for="nba_debut_date">NBA Debut Date</label>
            <input
              class="admin-form__input"
              id="nba_debut_date"
              name="nba_debut_date"
              type="date"
              value="{{ player.nba_debut_date.isoformat() if player.nba_debut_date else '' }}"
            />
          </div>

          <div class="admin-form__field">
            <label class="admin-form__label" for="nba_debut_season">NBA Debut Season</label>
            <input
              class="admin-form__input"
              id="nba_debut_season"
              name="nba_debut_season"
              type="text"
              placeholder="e.g., 2023-24"
              value="{{ player.nba_debut_season or '' }}"
            />
          </div>
        </div>

        <div class="admin-form__field">
          <label class="admin-form__label" for="reference_image_url">Reference Image URL</label>
          <input
            class="admin-form__input"
            id="reference_image_url"
            name="reference_image_url"
            type="url"
            placeholder="https://..."
            value="{{ player.reference_image_url or '' }}"
          />
          <span class="admin-form__help">URL to reference image for AI likeness generation</span>
        </div>
      </div>

      <!-- Metadata (read-only) -->
      <div class="admin-form__section">
        <h3 class="admin-form__section-title">Metadata</h3>

        <div class="admin-form__row">
          <div class="admin-form__static-field">
            <span class="admin-form__label">Created</span>
            <span class="admin-form__static-value">{{ player.created_at.strftime('%Y-%m-%d %H:%M') if player.created_at else '—' }}</span>
          </div>

          <div class="admin-form__static-field">
            <span class="admin-form__label">Updated</span>
            <span class="admin-form__static-value">{{ player.updated_at.strftime('%Y-%m-%d %H:%M') if player.updated_at else '—' }}</span>
          </div>
        </div>
      </div>

      <div class="admin-form__actions">
        <button type="submit" class="admin-btn admin-btn--primary">Save Changes</button>
        <a href="/admin/players" class="admin-btn admin-btn--secondary">Cancel</a>
      </div>
    </form>
  </div>

  <!-- Right Column: Player Image (S3-first) -->
  <div class="admin-card admin-player-detail-layout__sidebar">
    <h3 class="admin-form__section-title">Player Image</h3>

    {% if expected_image_url %}
    <div class="admin-image-card">
      <img src="{{ expected_image_url }}" alt="{{ player.display_name }}" class="admin-image-thumbnail"
           onerror="this.src='{{ placeholder_url }}';">
      <div class="admin-image-card__overlay">
        <div class="admin-image-card__meta">
          <span class="admin-badge admin-badge--style-default">default</span>
        </div>
      </div>
    </div>
    <a href="/admin/images?player_id={{ player.id }}" class="admin-btn admin-btn--secondary admin-btn--small admin-btn--block" style="margin-top: 1rem;">
      View All Images
    </a>
    {% else %}
    <p class="admin-text--muted">No slug set - cannot construct image URL.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
