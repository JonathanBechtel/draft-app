{% extends "admin/base.html" %}

{% set page_title = "Players" %}
{% set active_nav = "players" %}

{% block admin_content %}
<header class="admin-main__header">
  <h1 class="admin-main__title">Players</h1>
  <p class="admin-main__subtitle">Manage player records</p>
</header>

<div class="admin-card">
  <div class="admin-card__header">
    <h2 class="admin-card__title">All Players ({{ total }})</h2>
    <a href="/admin/players/new" class="admin-btn admin-btn--primary">Add Player</a>
  </div>

  <!-- Filters -->
  <form class="admin-filters" method="get" action="/admin/players">
    <input type="hidden" name="limit" value="{{ limit }}">

    <div class="admin-filters__row">
      <div class="admin-filters__field admin-filters__field--wide">
        <label class="admin-filters__label" for="q">Search</label>
        <input class="admin-form__input" type="text" id="q" name="q"
               value="{{ q or '' }}" placeholder="Name, school...">
      </div>

      <div class="admin-filters__field">
        <label class="admin-filters__label" for="draft_year">Draft Year</label>
        <select class="admin-form__select" id="draft_year" name="draft_year">
          <option value="">All Years</option>
          {% for year in draft_years %}
          <option value="{{ year }}" {% if draft_year == year %}selected{% endif %}>
            {{ year }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="admin-filters__field">
        <label class="admin-filters__label" for="nba_status">NBA Status</label>
        <select class="admin-form__select" id="nba_status" name="nba_status">
          <option value="">All</option>
          <option value="active" {% if nba_status == 'active' %}selected{% endif %}>NBA Active</option>
          <option value="inactive" {% if nba_status == 'inactive' %}selected{% endif %}>Not Active</option>
          <option value="unknown" {% if nba_status == 'unknown' %}selected{% endif %}>Unknown</option>
        </select>
      </div>

      <div class="admin-filters__actions">
        <button type="submit" class="admin-btn admin-btn--primary admin-btn--small">Filter</button>
        <a href="/admin/players" class="admin-btn admin-btn--secondary admin-btn--small">Reset</a>
      </div>
    </div>
  </form>

  {% if players %}
  <table class="admin-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>School</th>
        <th>Draft</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for p in players %}
      <tr>
        <td>
          <a href="/admin/players/{{ p.player.id }}" class="admin-link">
            {{ p.player.display_name or '—' }}
          </a>
        </td>
        <td>
          {% if p.player.school %}
          {{ p.player.school }}
          {% else %}
          <span class="admin-text--placeholder">—</span>
          {% endif %}
        </td>
        <td>
          {% if p.player.draft_year %}
          {{ p.player.draft_year }}
          {% if p.player.draft_round and p.player.draft_pick %}
          R{{ p.player.draft_round }} P{{ p.player.draft_pick }}
          {% endif %}
          {% else %}
          <span class="admin-text--placeholder">—</span>
          {% endif %}
        </td>
        <td>
          {% if p.is_active_nba is true %}
          <span class="admin-badge admin-badge--active">NBA</span>
          {% elif p.is_active_nba is false %}
          <span class="admin-badge admin-badge--inactive">Not Active</span>
          {% else %}
          <span class="admin-badge admin-badge--unknown">Unknown</span>
          {% endif %}
        </td>
        <td>
          <div class="admin-table__actions">
            <a href="/admin/players/{{ p.player.id }}" class="admin-btn admin-btn--secondary admin-btn--small">Edit</a>
            <form method="post" action="/admin/players/{{ p.player.id }}/delete" class="admin-form--inline" onsubmit="return confirm('Are you sure you want to delete this player? This will cascade to related records.');">
              <button type="submit" class="admin-btn admin-btn--danger admin-btn--small">Delete</button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination -->
  {% if pages > 1 %}
  <nav class="admin-pagination">
    <div class="admin-pagination__info">
      Showing {{ offset + 1 }}-{{ [offset + limit, total] | min }} of {{ total }}
    </div>
    <div class="admin-pagination__controls">
      {% if current_page > 1 %}
      <a href="/admin/players?limit={{ limit }}&offset={{ (current_page - 2) * limit }}{% if q %}&q={{ q }}{% endif %}{% if draft_year %}&draft_year={{ draft_year }}{% endif %}{% if position %}&position={{ position }}{% endif %}{% if nba_status %}&nba_status={{ nba_status }}{% endif %}"
         class="admin-btn admin-btn--secondary admin-btn--small">Previous</a>
      {% endif %}

      <span class="admin-pagination__pages">
        Page {{ current_page }} of {{ pages }}
      </span>

      {% if current_page < pages %}
      <a href="/admin/players?limit={{ limit }}&offset={{ current_page * limit }}{% if q %}&q={{ q }}{% endif %}{% if draft_year %}&draft_year={{ draft_year }}{% endif %}{% if position %}&position={{ position }}{% endif %}{% if nba_status %}&nba_status={{ nba_status }}{% endif %}"
         class="admin-btn admin-btn--secondary admin-btn--small">Next</a>
      {% endif %}
    </div>
  </nav>
  {% endif %}

  {% else %}
  <div class="admin-empty">
    <div class="admin-empty__icon">&#127936;</div>
    <h3 class="admin-empty__title">No Players</h3>
    <p class="admin-empty__text">
      {% if q or draft_year or position or nba_status %}
      No players match your filters. Try adjusting the criteria.
      {% else %}
      No player records exist yet. Add a player to get started.
      {% endif %}
    </p>
    {% if q or draft_year or position or nba_status %}
    <a href="/admin/players" class="admin-btn admin-btn--secondary">Clear Filters</a>
    {% else %}
    <a href="/admin/players/new" class="admin-btn admin-btn--primary">Add Player</a>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
