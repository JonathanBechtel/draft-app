<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2400 1260" width="2400" height="1260">
  <defs>
    <style type="text/css">
      .title { font-family: 'Russo One', sans-serif; font-size: 80px; fill: #0f172a; text-transform: uppercase; }
      .context { font-family: 'Azeret Mono', monospace; font-size: 36px; fill: #64748b; }
      .label { font-family: 'Azeret Mono', monospace; font-size: 32px; fill: #334155; }
      .column-header { font-family: 'Russo One', sans-serif; font-size: 36px; fill: #64748b; text-transform: uppercase; }
      .value { font-family: 'Azeret Mono', monospace; font-size: 36px; fill: #0f172a; font-weight: 600; }
      .percentile { font-family: 'Azeret Mono', monospace; font-size: 28px; fill: #ffffff; font-weight: 600; }
      .watermark { font-family: 'Azeret Mono', monospace; font-size: 32px; fill: #ffffff; }
      .player-name { font-family: 'Russo One', sans-serif; font-size: 40px; fill: #0f172a; }
      .player-subtitle { font-family: 'Azeret Mono', monospace; font-size: 28px; fill: #64748b; }
    </style>
    <!-- Scanlines pattern -->
    <pattern id="scanlines" patternUnits="userSpaceOnUse" width="4" height="4">
      <line x1="0" y1="0" x2="4" y2="0" stroke="#0f172a" stroke-width="1" opacity="0.03"/>
    </pattern>
    <!-- Dot matrix pattern -->
    <pattern id="dotmatrix" patternUnits="userSpaceOnUse" width="24" height="24">
      <circle cx="12" cy="12" r="1" fill="#64748b" opacity="0.1"/>
    </pattern>
    <!-- Percentile bar gradient -->
    <linearGradient id="bar-elite" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#10b981"/>
      <stop offset="100%" style="stop-color:#06b6d4"/>
    </linearGradient>
    <linearGradient id="bar-good" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#06b6d4"/>
      <stop offset="100%" style="stop-color:#6366f1"/>
    </linearGradient>
    <linearGradient id="bar-average" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f59e0b"/>
      <stop offset="100%" style="stop-color:#f97316"/>
    </linearGradient>
    <linearGradient id="bar-below" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f43f5e"/>
      <stop offset="100%" style="stop-color:#dc2626"/>
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="2400" height="1260" fill="#f8fafc"/>
  <rect width="2400" height="1260" fill="url(#dotmatrix)"/>
  <rect width="2400" height="1260" fill="url(#scanlines)"/>

  <!-- Accent bar at top -->
  <rect x="0" y="0" width="2400" height="12" fill="{{ accent_color }}"/>

  <!-- Header section -->
  <g transform="translate(96, 80)">
    <!-- Player photo or placeholder (offset to align with text block) -->
    {% if player.has_photo and player.photo_data_uri %}
    <clipPath id="photo-clip">
      <rect x="0" y="30" width="200" height="200" rx="12"/>
    </clipPath>
    <image href="{{ player.photo_data_uri }}" x="0" y="30" width="200" height="200" clip-path="url(#photo-clip)" preserveAspectRatio="xMidYMid slice"/>
    <rect x="0" y="30" width="200" height="200" rx="12" fill="none" stroke="{{ accent_color }}" stroke-width="4"/>
    {% else %}
    <rect x="0" y="30" width="200" height="200" rx="12" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="2"/>
    <text x="100" y="120" text-anchor="middle" class="label" fill="#475569">{{ player.name.split()[0] }}</text>
    {% if player.name.split() | length > 1 %}
    <text x="100" y="160" text-anchor="middle" class="label" fill="#475569">{{ player.name.split()[1:] | join(' ') }}</text>
    {% endif %}
    {% endif %}

    <!-- Title and context -->
    <text x="240" y="50" class="title">{{ title }}</text>
    <text x="240" y="115" class="context">{{ context_line.rendered }}</text>

    <!-- Player info below title -->
    <text x="240" y="180" class="player-name">{{ player.name }}</text>
    <text x="240" y="225" class="player-subtitle">{{ player.subtitle }}</text>
  </g>

  <!-- Divider line -->
  <line x1="96" y1="340" x2="2304" y2="340" stroke="#e2e8f0" stroke-width="2"/>

  <!-- Column headers -->
  <g transform="translate(96, 380)">
    <text x="0" y="0" class="column-header">Metric</text>
    <text x="1100" y="0" text-anchor="middle" class="column-header">Percentile Rank</text>
    <text x="2208" y="0" text-anchor="end" class="column-header">Value</text>
  </g>

  <!-- Metric rows -->
  <g transform="translate(96, 420)">
    {% for row in rows %}
    {% set y_offset = loop.index0 * 85 %}
    {% if row.label %}
    <!-- Row {{ loop.index }} -->
    <g transform="translate(0, {{ y_offset }})">
      <!-- Label -->
      <text x="0" y="45" class="label">{{ row.label }}</text>

      <!-- Bar track -->
      <rect x="400" y="20" width="1400" height="44" rx="6" fill="#e2e8f0"/>

      <!-- Bar fill -->
      {% set bar_width = (row.percentile / 100) * 1400 %}
      {% set bar_gradient = 'bar-' ~ row.tier.value %}
      <rect x="400" y="20" width="{{ bar_width }}" height="44" rx="6" fill="url(#{{ bar_gradient }})"/>

      <!-- Percentile label on bar -->
      {% set label_x = 400 + (bar_width / 2) %}
      {% if bar_width > 100 %}
      <text x="{{ label_x }}" y="52" text-anchor="middle" class="percentile">{{ row.percentile_label }}</text>
      {% else %}
      <text x="{{ 400 + bar_width + 20 }}" y="52" text-anchor="start" class="label" fill="#64748b">{{ row.percentile_label }}</text>
      {% endif %}

      <!-- Value on right -->
      <text x="2208" y="52" text-anchor="end" class="value">{{ row.value }}</text>
    </g>
    {% endif %}
    {% endfor %}
  </g>

  <!-- Footer watermark bar -->
  <rect x="0" y="1148" width="2400" height="112" fill="#1e293b"/>
  <text x="2304" y="1216" text-anchor="end" class="watermark">nbadraft.app</text>

  <!-- Scanlines overlay on footer -->
  <rect x="0" y="1148" width="2400" height="112" fill="url(#scanlines)" opacity="0.5"/>
</svg>
