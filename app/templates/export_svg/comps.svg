<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2400 1260" width="2400" height="1260">
  <defs>
    <style type="text/css">
      .title { font-family: 'Russo One', sans-serif; font-size: 72px; fill: #0f172a; text-transform: uppercase; }
      .context { font-family: 'Azeret Mono', monospace; font-size: 32px; fill: #64748b; }
      .label { font-family: 'Azeret Mono', monospace; font-size: 28px; fill: #334155; }
      .watermark { font-family: 'Azeret Mono', monospace; font-size: 32px; fill: #ffffff; }
      .player-name { font-family: 'Russo One', sans-serif; font-size: 36px; fill: #0f172a; }
      .player-subtitle { font-family: 'Azeret Mono', monospace; font-size: 24px; fill: #64748b; }
      .comp-name { font-family: 'Russo One', sans-serif; font-size: 32px; fill: #0f172a; }
      .comp-subtitle { font-family: 'Azeret Mono', monospace; font-size: 22px; fill: #64748b; }
      .similarity-label { font-family: 'Azeret Mono', monospace; font-size: 24px; fill: #ffffff; font-weight: 600; }
    </style>
    <!-- Scanlines pattern -->
    <pattern id="scanlines" patternUnits="userSpaceOnUse" width="4" height="4">
      <line x1="0" y1="0" x2="4" y2="0" stroke="#0f172a" stroke-width="1" opacity="0.03"/>
    </pattern>
    <!-- Dot matrix pattern -->
    <pattern id="dotmatrix" patternUnits="userSpaceOnUse" width="24" height="24">
      <circle cx="12" cy="12" r="1" fill="#64748b" opacity="0.1"/>
    </pattern>
  </defs>

  <!-- Background -->
  <rect width="2400" height="1260" fill="#f8fafc"/>
  <rect width="2400" height="1260" fill="url(#dotmatrix)"/>
  <rect width="2400" height="1260" fill="url(#scanlines)"/>

  <!-- Accent bar at top -->
  <rect x="0" y="0" width="2400" height="12" fill="{{ accent_color }}"/>

  <!-- Header section -->
  <g transform="translate(96, 60)">
    <!-- Player photo or placeholder -->
    {% if player.has_photo and player.photo_data_uri %}
    <clipPath id="photo-clip">
      <rect x="0" y="0" width="180" height="180" rx="12"/>
    </clipPath>
    <image href="{{ player.photo_data_uri }}" x="0" y="0" width="180" height="180" clip-path="url(#photo-clip)" preserveAspectRatio="xMidYMid slice"/>
    <rect x="0" y="0" width="180" height="180" rx="12" fill="none" stroke="{{ accent_color }}" stroke-width="4"/>
    {% else %}
    <rect x="0" y="0" width="180" height="180" rx="12" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="2"/>
    <text x="90" y="80" text-anchor="middle" class="label" fill="#475569">{{ player.name.split()[0] }}</text>
    {% if player.name.split() | length > 1 %}
    <text x="90" y="115" text-anchor="middle" class="label" fill="#475569">{{ player.name.split()[1:] | join(' ') }}</text>
    {% endif %}
    {% endif %}

    <!-- Title and context -->
    <text x="220" y="55" class="title">{{ title }}</text>
    <text x="220" y="110" class="context">{{ context_line.rendered }}</text>

    <!-- Player info below title -->
    <text x="220" y="155" class="player-name">{{ player.name }}</text>
    <text x="220" y="190" class="player-subtitle">{{ player.subtitle }}</text>
  </g>

  <!-- Divider line -->
  <line x1="96" y1="280" x2="2304" y2="280" stroke="#e2e8f0" stroke-width="2"/>

  <!-- Comparison tiles grid (2 rows x 3 columns) -->
  <g transform="translate(96, 310)">
    {% for tile in tiles %}
    {% set col = loop.index0 % 3 %}
    {% set row_num = loop.index0 // 3 %}
    {% set x_offset = col * 740 %}
    {% set y_offset = row_num * 400 %}

    {% if tile.name != 'â€”' %}
    <g transform="translate({{ x_offset }}, {{ y_offset }})">
      <!-- Card background -->
      <rect x="0" y="0" width="700" height="370" rx="16" fill="#ffffff" stroke="#e2e8f0" stroke-width="2"/>

      <!-- Player photo or placeholder -->
      {% if tile.has_photo and tile.photo_data_uri %}
      <clipPath id="comp-photo-{{ loop.index }}">
        <rect x="30" y="30" width="200" height="200" rx="10"/>
      </clipPath>
      <image href="{{ tile.photo_data_uri }}" x="30" y="30" width="200" height="200" clip-path="url(#comp-photo-{{ loop.index }})" preserveAspectRatio="xMidYMid slice"/>
      <rect x="30" y="30" width="200" height="200" rx="10" fill="none" stroke="#e2e8f0" stroke-width="2"/>
      {% else %}
      <rect x="30" y="30" width="200" height="200" rx="10" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="2"/>
      <text x="130" y="115" text-anchor="middle" class="label" fill="#475569">{{ tile.name.split()[0] }}</text>
      {% if tile.name.split() | length > 1 %}
      <text x="130" y="150" text-anchor="middle" class="label" fill="#475569">{{ tile.name.split()[1:] | join(' ') }}</text>
      {% endif %}
      {% endif %}

      <!-- Similarity badge -->
      {% set badge_color = '#10b981' if tile.tier.value == 'elite' else '#06b6d4' if tile.tier.value == 'good' else '#f59e0b' if tile.tier.value == 'average' else '#94a3b8' %}
      <rect x="30" y="250" width="200" height="40" rx="20" fill="{{ badge_color }}"/>
      <text x="130" y="278" text-anchor="middle" class="similarity-label">{{ tile.similarity_label }} Match</text>

      <!-- Player info (right side) -->
      <text x="260" y="80" class="comp-name">{{ tile.name }}</text>
      <text x="260" y="115" class="comp-subtitle">{{ tile.subtitle }}</text>

      <!-- Rank indicator -->
      <text x="260" y="180" class="label" fill="#64748b">#{{ loop.index }} Similar</text>
    </g>
    {% endif %}
    {% endfor %}
  </g>

  <!-- Footer watermark bar -->
  <rect x="0" y="1148" width="2400" height="112" fill="#1e293b"/>
  <text x="2304" y="1216" text-anchor="end" class="watermark">nbadraft.app</text>

  <!-- Scanlines overlay on footer -->
  <rect x="0" y="1148" width="2400" height="112" fill="url(#scanlines)" opacity="0.5"/>
</svg>
